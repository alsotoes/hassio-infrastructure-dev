#include <tunables/global>

profile hassio-addon-afp_to_s3 flags=(attach_disconnected,mediate_deleted) {
  #include <abstractions/base>

  # Network access
  network inet stream,
  network inet6 stream,

  # File access
  /data/options.json r,
  /run.sh mr,
  /usr/local/bin/minio mr,
  /mnt/afp/ rw,
  /mnt/afp/** rw,

  # Executables
  /bin/bash rix,
  /usr/bin/jq rix,
  /usr/bin/wget rix,
  /usr/bin/afp_client rix,
  /usr/local/bin/minio rix,

  # For afp_client mount
  capability sys_admin,
  capability dac_override,

  # Deny all other access
  deny @{HOME}/.* mrwklx,
}
