#!/usr/bin/with-contenv bashio
set -euo pipefail

CFG_DIR="/etc/avahi"
mkdir -p "${CFG_DIR}"

AVAHI_HOSTNAME="$(bashio::config 'avahi_hostname')"
AVAHI_IFACE="$(bashio::config 'avahi_interface')"
PUBLISH_WS="$(bashio::config 'avahi_publish_workstation')"

cat > "${CFG_DIR}/avahi-daemon.conf" <<EOF
[server]
host-name=${AVAHI_HOSTNAME}
domain-name=local
use-ipv4=yes
use-ipv6=no
allow-interfaces=${AVAHI_IFACE}

[wide-area]
enable-wide-area=no

[publish]
publish-hinfo=no
publish-workstation=$( [ "${PUBLISH_WS}" = "true" ] && echo "yes" || echo "no" )
publish-aaaa-on-ipv4=no
publish-a-on-ipv6=no
EOF
